name: Build and Release

on:
  push:
    tags:
      - "v*.*.*" # è§¦å‘æ¡ä»¶ï¼šæ¨é€ç‰ˆæœ¬æ ‡ç­¾ï¼Œå¦‚ v1.0.0
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘
    inputs:
      tag:
        description: "Release tag (e.g., v1.0.0)"
        required: true
        type: string

permissions:           # â† æ·»åŠ è¿™ä¸ªéƒ¨åˆ†
  contents: write      # â† å…è®¸åˆ›å»ºreleaseå’Œä¸Šä¼ æ–‡ä»¶
  actions: read        # â† å…è®¸è¯»å–actionsçŠ¶æ€
  checks: write        # â† å…è®¸å†™å…¥æ£€æŸ¥ç»“æœ

env:
  CARGO_TERM_COLOR: always
  RUST_BACKTRACE: 1

jobs:
  build-release:
    name: Build Release (${{ matrix.platform.name }})

    strategy:
      fail-fast: false
      matrix:
        platform:
          # - name: Linux DEB
          #   os: ubuntu-latest
          #   rust-target: x86_64-unknown-linux-gnu
          #   artifact-name: linux-x86_64-deb
          #   bundle-type: deb
          #   bundle-pattern: "*.deb"
          #   file-suffix: deb
          # - name: Linux RPM
          #   os: ubuntu-latest
          #   rust-target: x86_64-unknown-linux-gnu
          #   artifact-name: linux-x86_64-rpm
          #   bundle-type: rpm
          #   bundle-pattern: "*.rpm"
          #   file-suffix: rpm
          - name: Windows MSI
            os: windows-latest
            rust-target: x86_64-pc-windows-msvc
            artifact-name: windows-x86_64-msi
            bundle-type: msi
            bundle-pattern: "*.msi"
            file-suffix: msi
          - name: Windows EXE
            os: windows-latest
            rust-target: x86_64-pc-windows-msvc
            artifact-name: windows-x86_64-exe
            bundle-type: nsis
            bundle-pattern: "*.exe"
            file-suffix: exe
          - name: macOS Intel
            os: macos-13
            rust-target: x86_64-apple-darwin
            artifact-name: macos-x86_64
            bundle-type: dmg
            bundle-pattern: "*.dmg"
            file-suffix: dmg
          - name: macOS Apple Silicon
            os: macos-latest
            rust-target: aarch64-apple-darwin
            artifact-name: macos-aarch64
            bundle-type: dmg
            bundle-pattern: "*.dmg"
            file-suffix: dmg

    runs-on: ${{ matrix.platform.os }}

    steps:
      # æ£€å‡ºä»£ç 
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # å®‰è£…Linuxç³»ç»Ÿä¾èµ–
      - name: Install Linux dependencies
        if: matrix.platform.os == 'ubuntu-latest'
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            libwebkit2gtk-4.1-dev \
            libgtk-3-dev \
            libayatana-appindicator3-dev \
            librsvg2-dev \
            libssl-dev \
            libglib2.0-dev \
            libjavascriptcoregtk-4.1-dev \
            libsoup-3.0-dev \
            libxdo-dev \
            libxcb-shape0-dev \
            libxcb-xfixes0-dev \
            rpm \
            file \
            patchelf \
            libc6-dev

      # è®¾ç½®Rustå·¥å…·é“¾
      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: ${{ matrix.platform.rust-target }}

      # ç¼“å­˜Rustä¾èµ–
      - name: Cache Rust dependencies
        uses: Swatinem/rust-cache@v2
        with:
          workspaces: "./src-tauri -> target"
          key: ${{ matrix.platform.os }}-${{ matrix.platform.rust-target }}-rust-${{ hashFiles('**/Cargo.lock') }}

      # è®¾ç½®Bun
      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      # ç¼“å­˜Bunä¾èµ–
      - name: Cache Bun dependencies
        uses: actions/cache@v4
        with:
          path: |
            ~/.bun
            node_modules
          key: ${{ matrix.platform.os }}-bun-${{ hashFiles('bun.lockb', 'package.json') }}
          restore-keys: |
            ${{ matrix.platform.os }}-bun-

      # å®‰è£…å‰ç«¯ä¾èµ–
      - name: Install frontend dependencies
        run: bun install

      # æ„å»ºClaude Codeå¯æ‰§è¡Œæ–‡ä»¶
      - name: Build Claude Code executables
        run: |
          if [ "${{ matrix.platform.os }}" = "ubuntu-latest" ]; then
            bun run build:executables:linux
          elif [ "${{ matrix.platform.os }}" = "windows-latest" ]; then
            bun run build:executables:windows
          elif [[ "${{ matrix.platform.os }}" == macos* ]]; then
            bun run build:executables:macos
          fi
        shell: bash

      # æ„å»ºå‰ç«¯
      - name: Build frontend
        run: bun run build

      # ç¡®ä¿æ„å»ºç›®å½•å­˜åœ¨
      - name: Prepare build directories
        run: |
          mkdir -p src-tauri/target/release/bundle
          echo "ğŸ“ åˆ›å»ºæ„å»ºç›®å½•å®Œæˆ"

      # éªŒè¯Claude CodeäºŒè¿›åˆ¶æ–‡ä»¶
      - name: Verify Claude Code binary
        run: |
          echo "ğŸ” éªŒè¯Claude CodeäºŒè¿›åˆ¶æ–‡ä»¶..."
          echo "ğŸ“‹ src-tauri/binariesç›®å½•å†…å®¹:"
          ls -la src-tauri/binaries/ || echo "src-tauri/binariesç›®å½•ä¸å­˜åœ¨"
          
          # æŸ¥æ‰¾ç›¸åº”å¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶
          if [ "${{ matrix.platform.os }}" = "ubuntu-latest" ]; then
            BINARY_PATTERN="claude-code-*-linux-*"
          elif [ "${{ matrix.platform.os }}" = "windows-latest" ]; then
            BINARY_PATTERN="claude-code-*-windows-*.exe"
          elif [[ "${{ matrix.platform.os }}" == macos* ]]; then
            BINARY_PATTERN="claude-code-*-darwin*"
          fi
          
          BINARY_FILE=$(find src-tauri/binaries -name "$BINARY_PATTERN" 2>/dev/null | head -1)
          if [ -n "$BINARY_FILE" ] && [ -f "$BINARY_FILE" ]; then
            echo "âœ… æ‰¾åˆ°äºŒè¿›åˆ¶æ–‡ä»¶: $BINARY_FILE"
            ls -la "$BINARY_FILE"
            if [ "${{ matrix.platform.os }}" = "ubuntu-latest" ]; then
              echo "ğŸ“‹ ä¾èµ–åˆ†æ:"
              ldd "$BINARY_FILE" || echo "âš ï¸ lddæ£€æŸ¥å¤±è´¥ï¼Œå¯èƒ½æ˜¯é™æ€é“¾æ¥"
            fi
          else
            echo "âŒ æœªæ‰¾åˆ°å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶"
            echo "ğŸ“‹ æœç´¢æ‰€æœ‰claude-codeæ–‡ä»¶:"
            find . -name "claude-code*" -type f 2>/dev/null || true
          fi
        shell: bash

      # æ„å»ºTauriåº”ç”¨ç¨‹åº
      - name: Build Tauri application
        run: |
          echo "ğŸš€ å¼€å§‹æ„å»ºTauriåº”ç”¨ç¨‹åº..."
          
          # ç¡®ä¿src-tauri/binariesç›®å½•å­˜åœ¨ä¸”æœ‰äºŒè¿›åˆ¶æ–‡ä»¶
          if [ ! -d "src-tauri/binaries" ] || [ -z "$(ls -A src-tauri/binaries)" ]; then
            echo "âš ï¸ è­¦å‘Š: src-tauri/binariesç›®å½•ä¸ºç©ºæˆ–ä¸å­˜åœ¨"
            echo "ğŸ“‹ å°è¯•é‡æ–°æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶..."
            if [ "${{ matrix.platform.os }}" = "ubuntu-latest" ]; then
              bun run build:executables:linux
            elif [ "${{ matrix.platform.os }}" = "windows-latest" ]; then
              bun run build:executables:windows
            elif [[ "${{ matrix.platform.os }}" == macos* ]]; then
              bun run build:executables:macos
            fi
          fi
          
          echo "ğŸ“‹ æ„å»ºå‚æ•°:"
          echo "  - Bundle type: ${{ matrix.platform.bundle-type }}"
          echo "  - Rust target: ${{ matrix.platform.rust-target }}"
          
          if [[ "${{ matrix.platform.os }}" == macos* ]]; then
            echo "ğŸ“‹ æ‰§è¡Œå‘½ä»¤: bun run tauri build --target ${{ matrix.platform.rust-target }} --bundles ${{ matrix.platform.bundle-type }} --verbose -c src-tauri/tauri.conf.release.json"
            bun run tauri build --target ${{ matrix.platform.rust-target }} --bundles ${{ matrix.platform.bundle-type }} --verbose -c src-tauri/tauri.conf.release.json
          else
            echo "ğŸ“‹ æ‰§è¡Œå‘½ä»¤: bun run tauri build --bundles ${{ matrix.platform.bundle-type }} --verbose -c src-tauri/tauri.conf.release.json"
            bun run tauri build --bundles ${{ matrix.platform.bundle-type }} --verbose -c src-tauri/tauri.conf.release.json
          fi
        shell: bash
        env:
          TAURI_SIGNING_PRIVATE_KEY: ${{ secrets.TAURI_SIGNING_PRIVATE_KEY }}
          TAURI_SIGNING_PRIVATE_KEY_PASSWORD: ${{ secrets.TAURI_SIGNING_PRIVATE_KEY_PASSWORD }}



      # æŸ¥æ‰¾æ„å»ºäº§ç‰©
      - name: Find build artifacts
        id: find-artifacts
        run: |
          echo "ğŸ” æŸ¥æ‰¾æ„å»ºäº§ç‰©..."
          echo "Bundle type: ${{ matrix.platform.bundle-type }}"
          echo "Rust target: ${{ matrix.platform.rust-target }}"

          # æ˜¾ç¤ºå®Œæ•´æ„å»ºç›®å½•ç»“æ„
          echo "ğŸ“ å®Œæ•´æ„å»ºç›®å½•ç»“æ„:"
          find src-tauri/target -type f \( -name "*.deb" -o -name "*.rpm" -o -name "*.msi" -o -name "*.exe" -o -name "*.dmg" \) 2>/dev/null || echo "æœªæ‰¾åˆ°ä»»ä½•æ„å»ºäº§ç‰©"
          
          echo "ğŸ“ targetç›®å½•ç»“æ„:"
          ls -la src-tauri/target/ 2>/dev/null || echo "targetç›®å½•ä¸å­˜åœ¨"
          
          if [ -d "src-tauri/target/release" ]; then
            echo "ğŸ“ releaseç›®å½•ç»“æ„:"
            ls -la src-tauri/target/release/ 2>/dev/null
            if [ -d "src-tauri/target/release/bundle" ]; then
              echo "ğŸ“ bundleç›®å½•ç»“æ„:"
              find src-tauri/target/release/bundle -type f 2>/dev/null || echo "bundleç›®å½•ä¸ºç©º"
            fi
          fi

          if [ "${{ matrix.platform.bundle-type }}" = "deb" ]; then
            BUNDLE_PATH=$(find src-tauri/target/release/bundle/deb -name "*.deb" | head -1)
          elif [ "${{ matrix.platform.bundle-type }}" = "rpm" ]; then
            BUNDLE_PATH=$(find src-tauri/target/release/bundle/rpm -name "*.rpm" | head -1)
          elif [ "${{ matrix.platform.bundle-type }}" = "msi" ]; then
            BUNDLE_PATH=$(find src-tauri/target/release/bundle/msi -name "*.msi" | head -1)
          elif [ "${{ matrix.platform.bundle-type }}" = "nsis" ]; then
            BUNDLE_PATH=$(find src-tauri/target/release/bundle/nsis -name "*.exe" | head -1)
          elif [ "${{ matrix.platform.bundle-type }}" = "dmg" ]; then
            if [ "${{ matrix.platform.rust-target }}" = "aarch64-apple-darwin" ]; then
              BUNDLE_PATH=$(find src-tauri/target/aarch64-apple-darwin/release/bundle/dmg -name "*.dmg" | head -1)
            elif [ "${{ matrix.platform.rust-target }}" = "x86_64-apple-darwin" ]; then
              BUNDLE_PATH=$(find src-tauri/target/x86_64-apple-darwin/release/bundle/dmg -name "*.dmg" | head -1)
            else
              BUNDLE_PATH=$(find src-tauri/target/release/bundle/dmg -name "*.dmg" | head -1)
            fi
          fi

          if [ -z "$BUNDLE_PATH" ] || [ ! -f "$BUNDLE_PATH" ]; then
            echo "âŒ æœªæ‰¾åˆ°æ„å»ºäº§ç‰©!"
            echo "æŸ¥æ‰¾è·¯å¾„:"
            find src-tauri/target -type d -name "bundle" 2>/dev/null || true
            find src-tauri/target -type f \( -name "*.deb" -o -name "*.rpm" -o -name "*.msi" -o -name "*.exe" -o -name "*.dmg" \) 2>/dev/null || true
            exit 1
          fi

          echo "âœ… æ‰¾åˆ°æ„å»ºäº§ç‰©: $BUNDLE_PATH"
          echo "bundle_path=$BUNDLE_PATH" >> $GITHUB_OUTPUT
          echo "bundle_name=$(basename "$BUNDLE_PATH")" >> $GITHUB_OUTPUT
        shell: bash

      # é‡å‘½åæ„å»ºäº§ç‰©
      - name: Rename build artifacts
        run: |
          ORIGINAL_NAME="${{ steps.find-artifacts.outputs.bundle_name }}"
          EXTENSION="${ORIGINAL_NAME##*.}"

          # æ ¹æ®å¹³å°å’Œæ¶æ„ç”Ÿæˆæ–‡ä»¶åï¼Œä¸åŒ…å«æ–‡ä»¶ç±»å‹åç¼€
          if [ "${{ matrix.platform.bundle-type }}" = "deb" ]; then
            NEW_NAME="termiclaude-linux-x86_64.${EXTENSION}"
          elif [ "${{ matrix.platform.bundle-type }}" = "rpm" ]; then
            NEW_NAME="termiclaude-linux-x86_64.${EXTENSION}"
          elif [ "${{ matrix.platform.bundle-type }}" = "msi" ]; then
            NEW_NAME="termiclaude-windows-x86_64.${EXTENSION}"
          elif [ "${{ matrix.platform.bundle-type }}" = "nsis" ]; then
            NEW_NAME="termiclaude-windows-x86_64.${EXTENSION}"
          elif [ "${{ matrix.platform.bundle-type }}" = "dmg" ]; then
            if [ "${{ matrix.platform.rust-target }}" = "aarch64-apple-darwin" ]; then
              NEW_NAME="termiclaude-macos-aarch64.${EXTENSION}"
            else
              NEW_NAME="termiclaude-macos-x86_64.${EXTENSION}"
            fi
          fi

          cp "${{ steps.find-artifacts.outputs.bundle_path }}" "$NEW_NAME"
          echo "ARTIFACT_PATH=$NEW_NAME" >> $GITHUB_ENV
          echo "ARTIFACT_NAME=$NEW_NAME" >> $GITHUB_ENV
          echo "âœ… é‡å‘½åæ–‡ä»¶: $ORIGINAL_NAME -> $NEW_NAME"
        shell: bash

      # ä¸Šä¼ æ„å»ºäº§ç‰©
      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.platform.artifact-name }}
          path: ${{ env.ARTIFACT_PATH }}
          retention-days: 7

  # åˆ›å»ºRelease
  create-release:
    name: Create Release
    runs-on: ubuntu-latest
    needs: [build-release]
    if: always() && needs.build-release.result == 'success'

    steps:
      # æ£€å‡ºä»£ç 
      - name: Checkout repository
        uses: actions/checkout@v4

      # ä¸‹è½½æ‰€æœ‰æ„å»ºäº§ç‰©
      - name: Download all artifacts
        uses: actions/download-artifact@v4
        with:
          path: ./artifacts

      # å‡†å¤‡å‘å¸ƒæ–‡ä»¶
      - name: Prepare release files
        run: |
          mkdir -p ./release-files
          echo "ğŸ“¦ æŸ¥æ‰¾æ‰€æœ‰æ„å»ºäº§ç‰©..."
          find ./artifacts -type f \( -name "*.deb" -o -name "*.rpm" -o -name "*.msi" -o -name "*.exe" -o -name "*.dmg" \) -print
          echo "ğŸ“¦ å¤åˆ¶æ„å»ºäº§ç‰©åˆ°å‘å¸ƒç›®å½•..."
          find ./artifacts -type f \( -name "*.deb" -o -name "*.rpm" -o -name "*.msi" -o -name "*.exe" -o -name "*.dmg" \) -exec cp {} ./release-files/ \;
          echo "ğŸ“¦ å‘å¸ƒæ–‡ä»¶åˆ—è¡¨:"
          ls -la ./release-files/

          # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶è¢«å¤åˆ¶
          if [ -z "$(ls -A ./release-files/)" ]; then
            echo "âŒ æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ„å»ºäº§ç‰©!"
            echo "artifacts ç›®å½•å†…å®¹:"
            find ./artifacts -type f -ls
            exit 1
          fi
        shell: bash

      # è·å–ç‰ˆæœ¬æ ‡ç­¾
      - name: Get version tag
        id: get-version
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "version=${{ github.event.inputs.tag }}" >> $GITHUB_OUTPUT
          else
            echo "version=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
          fi
        shell: bash

      # ç”Ÿæˆæ›´æ–°æ—¥å¿—
      - name: Generate changelog
        id: changelog
        run: |
          VERSION="${{ steps.get-version.outputs.version }}"
          echo "## ğŸš€ TermiClaude ${VERSION}" > CHANGELOG.md
          echo "" >> CHANGELOG.md

          # ä¸­æ–‡ç‰ˆæœ¬
          echo "### ğŸ“¦ å®‰è£…åŒ…ä¸‹è½½ / Download Packages" >> CHANGELOG.md
          echo "" >> CHANGELOG.md

          for file in ./release-files/*; do
            if [ -f "$file" ]; then
              filename=$(basename "$file")
              if [[ "$filename" == *"linux"* && "$filename" == *".deb" ]]; then
                echo "- **Linux DEB (x86_64)**: \`$filename\`" >> CHANGELOG.md
              elif [[ "$filename" == *"linux"* && "$filename" == *".rpm" ]]; then
                echo "- **Linux RPM (x86_64)**: \`$filename\`" >> CHANGELOG.md
              elif [[ "$filename" == *"windows"* && "$filename" == *".msi" ]]; then
                echo "- **Windows MSI (x86_64)**: \`$filename\`" >> CHANGELOG.md
              elif [[ "$filename" == *"windows"* && "$filename" == *".exe" ]]; then
                echo "- **Windows EXE (x86_64)**: \`$filename\`" >> CHANGELOG.md
              elif [[ "$filename" == *"macos-x86_64"* && "$filename" == *".dmg" ]]; then
                echo "- **macOS (Intel)**: \`$filename\`" >> CHANGELOG.md
              elif [[ "$filename" == *"macos-aarch64"* && "$filename" == *".dmg" ]]; then
                echo "- **macOS (Apple Silicon)**: \`$filename\`" >> CHANGELOG.md
              fi
            fi
          done

          echo "" >> CHANGELOG.md
          echo "### ğŸ“‹ ç³»ç»Ÿè¦æ±‚ / System Requirements" >> CHANGELOG.md
          echo "- **Linux**: Ubuntu 18.04+ æˆ–å…¶ä»–ç°ä»£Linuxå‘è¡Œç‰ˆ / Ubuntu 18.04+ or other modern Linux distributions" >> CHANGELOG.md
          echo "- **Windows**: Windows 10+ (64ä½) / Windows 10+ (64-bit)" >> CHANGELOG.md
          echo "- **macOS**: macOS 10.15+ (Catalina)" >> CHANGELOG.md
          echo "" >> CHANGELOG.md
          echo "### ğŸ”§ å®‰è£…è¯´æ˜ / Installation Instructions" >> CHANGELOG.md
          echo "" >> CHANGELOG.md
          echo "#### Linux" >> CHANGELOG.md
          echo "**DEB Package**:" >> CHANGELOG.md
          echo "- ä¸­æ–‡ï¼šä¸‹è½½ \`.deb\` æ–‡ä»¶ï¼Œä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…" >> CHANGELOG.md
          echo "- English: Download the \`.deb\` file and install using package manager" >> CHANGELOG.md
          echo "\`\`\`bash" >> CHANGELOG.md
          echo "# Ubuntu/Debian" >> CHANGELOG.md
          echo "sudo dpkg -i termiclaude-linux-x86_64.deb" >> CHANGELOG.md
          echo "sudo apt-get install -f  # è§£å†³ä¾èµ–é—®é¢˜ / Fix dependencies if needed" >> CHANGELOG.md
          echo "\`\`\`" >> CHANGELOG.md
          echo "" >> CHANGELOG.md
          echo "**RPM Package**:" >> CHANGELOG.md
          echo "- ä¸­æ–‡ï¼šä¸‹è½½ \`.rpm\` æ–‡ä»¶ï¼Œä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…" >> CHANGELOG.md
          echo "- English: Download the \`.rpm\` file and install using package manager" >> CHANGELOG.md
          echo "\`\`\`bash" >> CHANGELOG.md
          echo "# RHEL/CentOS/Fedora" >> CHANGELOG.md
          echo "sudo rpm -i termiclaude-linux-x86_64.rpm" >> CHANGELOG.md
          echo "# æˆ–è€…ä½¿ç”¨ dnf (Fedora)" >> CHANGELOG.md
          echo "sudo dnf install termiclaude-linux-x86_64.rpm" >> CHANGELOG.md
          echo "# æˆ–è€…ä½¿ç”¨ yum (RHEL/CentOS)" >> CHANGELOG.md
          echo "sudo yum install termiclaude-linux-x86_64.rpm" >> CHANGELOG.md
          echo "\`\`\`" >> CHANGELOG.md
          echo "" >> CHANGELOG.md
          echo "#### Windows" >> CHANGELOG.md
          echo "**MSI Installer**:" >> CHANGELOG.md
          echo "- ä¸­æ–‡ï¼šä¸‹è½½ \`.msi\` æ–‡ä»¶ï¼ŒåŒå‡»å®‰è£…ï¼ˆæ¨èï¼‰" >> CHANGELOG.md
          echo "- English: Download the \`.msi\` file and double-click to install (Recommended)" >> CHANGELOG.md
          echo "" >> CHANGELOG.md
          echo "**EXE Installer**:" >> CHANGELOG.md
          echo "- ä¸­æ–‡ï¼šä¸‹è½½ \`.exe\` æ–‡ä»¶ï¼Œå³é”®ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå®‰è£…" >> CHANGELOG.md
          echo "- English: Download the \`.exe\` file, right-click and run as administrator to install" >> CHANGELOG.md
          echo "" >> CHANGELOG.md
          echo "#### macOS" >> CHANGELOG.md
          echo "**DMG Package**:" >> CHANGELOG.md
          echo "- ä¸­æ–‡ï¼šä¸‹è½½ \`.dmg\` æ–‡ä»¶ï¼Œæ‰“å¼€åæ‹–æ‹½åˆ°åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹" >> CHANGELOG.md
          echo "- English: Download the \`.dmg\` file, open it and drag to Applications folder" >> CHANGELOG.md
          echo "" >> CHANGELOG.md
          echo "### âš ï¸ å®‰å…¨æç¤º / Security Notes" >> CHANGELOG.md
          echo "- ä¸­æ–‡ï¼šé¦–æ¬¡è¿è¡Œæ—¶ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæç¤ºå®‰å…¨è­¦å‘Šï¼Œè¯·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å…è®¸è¿è¡Œ" >> CHANGELOG.md
          echo "- English: On first run, the system may show security warnings. Please allow the app to run in system settings" >> CHANGELOG.md
          echo "- **macOS**: ç³»ç»Ÿåå¥½è®¾ç½® â†’ å®‰å…¨æ€§ä¸éšç§ â†’ é€šç”¨ / System Preferences â†’ Security & Privacy â†’ General" >> CHANGELOG.md
          echo "- **Windows**: Windowså®‰å…¨ä¸­å¿ƒ â†’ åº”ç”¨å’Œæµè§ˆå™¨æ§åˆ¶ / Windows Security â†’ App & browser control" >> CHANGELOG.md
        shell: bash

      # åˆ›å»ºGitHub Release
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.get-version.outputs.version }}
          name: TermiClaude ${{ steps.get-version.outputs.version }}
          body_path: CHANGELOG.md
          files: ./release-files/*
          draft: false
          prerelease: ${{ contains(steps.get-version.outputs.version, 'alpha') || contains(steps.get-version.outputs.version, 'beta') || contains(steps.get-version.outputs.version, 'rc') }}
          generate_release_notes: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # å‘å¸ƒæˆåŠŸé€šçŸ¥
      - name: Release summary
        run: |
          echo "ğŸ‰ Release ${{ steps.get-version.outputs.version }} created successfully!"
          echo "ğŸ“¦ åŒ…å«ä»¥ä¸‹å®‰è£…åŒ…:"
          ls -la ./release-files/
          echo ""
          echo "ğŸ”— Releaseé“¾æ¥: ${{ github.server_url }}/${{ github.repository }}/releases/tag/${{ steps.get-version.outputs.version }}"
        shell: bash
