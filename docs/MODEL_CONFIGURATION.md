# 模型配置指南

## 概述

Claudia 支持通过环境变量组来配置多个AI模型。每个环境变量组代表一个配置环境（如开发、测试、生产），**同时只能启用一个组**，实现真正的互斥性。

## 重要更新

- **互斥性**：现在启用一个环境变量组会自动禁用所有其他组
- **命名约定**：使用 `MID_*`、`MNAME_*`、`MDESC_*` 模式
- **动态模型**：支持任意AI服务提供商的模型

## 环境变量命名约定

### 模型定义

每个模型需要通过以下环境变量来定义：

```
MID_{序号}          - 模型的唯一标识符（必需）
MNAME_{序号}        - 模型的显示名称（可选，默认使用ID）
MDESC_{序号}        - 模型的描述信息（可选）
```

### 示例配置

#### 示例1：OpenAI配置
```
MID_1=gpt-4o
MNAME_1=GPT-4o
MDESC_1=OpenAI最新的GPT-4优化版本

MID_2=gpt-4-turbo
MNAME_2=GPT-4 Turbo
MDESC_2=更快的GPT-4版本

MID_3=gpt-3.5-turbo
MNAME_3=GPT-3.5 Turbo
MDESC_3=高性价比的对话模型

# API配置
OPENAI_API_KEY=sk-...
API_BASE_URL=https://api.openai.com/v1
```

#### 示例2：Claude配置
```
MID_1=claude-3-5-sonnet-20241022
MNAME_1=Claude 3.5 Sonnet
MDESC_1=Anthropic的平衡性能模型

MID_2=claude-3-opus-20240229
MNAME_2=Claude 3 Opus
MDESC_2=最强大的Claude模型

# API配置
ANTHROPIC_API_KEY=sk-ant-...
```

#### 示例3：智谱AI配置
```
MID_1=ZhipuAI/GLM-4.5
MNAME_1=GLM-4.5
MDESC_1=智谱AI的最新大模型

MID_2=ZhipuAI/GLM-4
MNAME_2=GLM-4
MDESC_2=智谱AI的主力模型

# API配置
ZHIPU_API_KEY=your_api_key
API_BASE_URL=https://open.bigmodel.cn/api/paas/v4
```

#### 示例4：本地模型配置
```
MID_1=llama-3.1-70b
MNAME_1=Llama 3.1 70B
MDESC_1=Meta的开源大语言模型

MID_2=qwen2-72b
MNAME_2=通义千问2 72B
MDESC_2=阿里云的中文优化模型

# 本地API配置
API_BASE_URL=http://localhost:11434/v1
```

## 使用方法

### 1. 创建环境变量组

- 在设置页面的"环境变量"标签页中创建新的环境变量组
- 为组设置描述性名称（如"OpenAI生产环境"、"Claude开发环境"等）

### 2. 添加模型变量

- 在组中按照命名约定添加模型相关的环境变量
- 确保 `MID_*` 变量包含有效的模型标识符
- 序号从1开始，可以不连续

### 3. 启用配置（互斥模式）

⚠️ **重要**：同时只能启用一个环境变量组！

- 启用新组时，所有其他组会自动禁用
- 启用组后，其中定义的所有模型将在模型选择器中显示
- 禁用组时，相关模型从选择器中移除

### 4. 验证配置

- 检查模型选择器中是否显示了正确的模型
- 发送测试消息确认模型可以正常使用
- 查看控制台日志了解详细的加载信息

## 互斥性行为

### 启用组时
```
启用组A → 自动禁用组B、组C、组D → 显示组A的模型
```

### 启用未分组变量时
```
启用未分组变量 → 自动禁用所有组 → 只显示未分组的模型配置
```

### 禁用当前组时
```
禁用组A → 无活跃配置 → 模型选择器显示默认Claude模型
```

## 注意事项

- **命名约定**：使用 `MID_*`、`MNAME_*`、`MDESC_*` 而不是旧的 `MODEL_*` 格式
- **互斥性**：同时只能有一个配置生效，避免配置冲突
- **序号顺序**：`MID_1`、`MID_2` 等序号决定模型在选择器中的显示顺序
- **必需字段**：只有 `MID_*` 是必需的，其他字段可选
- **即时更新**：切换环境变量组将立即更新可用的模型列表
- **兼容性**：支持任意AI服务提供商，包括OpenAI、Anthropic、本地模型等

## 故障排除

### 模型不显示
- 检查环境变量组是否已启用（只能启用一个）
- 确认 `MID_*` 变量格式正确且不为空
- 查看浏览器控制台了解详细错误信息
- 确认没有其他组处于启用状态

### 模型顺序错误
- 检查模型序号（`MID_1`、`MID_2` 等）
- 确保序号为有效数字
- 序号决定显示顺序，建议从1开始

### API调用失败
- 检查API密钥等认证信息是否正确
- 确认API基础URL指向正确的服务端点
- 验证模型ID是否与API服务提供的模型匹配
- 查看网络连接和防火墙设置

### 配置冲突
- 确保同时只启用一个环境变量组
- 如果出现意外行为，尝试禁用所有组后重新启用
- 检查未分组变量是否与组变量冲突

## 迁移指南

如果你使用的是旧版本的配置格式，请按以下步骤迁移：

### 从 `MODEL_*` 迁移到 `MID_*`

```bash
# 旧格式
MODEL_1_ID=gpt-4o
MODEL_1_NAME=GPT-4o
MODEL_1_DESCRIPTION=OpenAI最新模型

# 新格式
MID_1=gpt-4o
MNAME_1=GPT-4o
MDESC_1=OpenAI最新模型
```

1. 创建新的环境变量组
2. 使用新的命名约定添加变量
3. 删除旧的配置
4. 启用新组并测试